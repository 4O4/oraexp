
start_rule
        :	kleene_create_packages
	;

kleene_create_packages
        :       kleene_create_packages create_package
        |
        ;

create_package
        :	'CREATE' opt_or_replace package_spec_or_body
	;

or_replace
        :       'OR' 'REPLACE'
        ;

opt_or_replace
        :       or_replace
        |
        ;

package_spec_or_body
        :       package_spec
        |       package_body
        ;
	
package_spec
        :	'PACKAGE' package_name is_or_as
                package_obj_specs
                'END' opt_package_name PLS_SEMI
	;

opt_package_name
        :       package_name
        |
        ;

package_obj_specs
        :       package_obj_specs package_obj_spec
        |
        ;

is_or_as
        :       'IS' | as
        ;
	
package_body
        :	'PACKAGE' 'BODY' package_name is_or_as
                package_obj_bodies
                opt_package_body
                'END' opt_package_name PLS_SEMI
	;

package_obj_bodies
        :       package_obj_bodies package_obj_body
        |
        ;

opt_package_body
        :       'BEGIN' seq_of_statements
        |
        ;

package_name
        :	opt_schema_prefix identifier
	;

opt_schema_prefix
        :       schema_name PLS_DOT
        |
        ;

package_obj_spec
	:	variable_declaration 
	|	type_declaration
	|	subtype_declaration 
	|	record_declaration 
	|	plsql_table_declaration 
	|	varray_declaration
	|	cursor_declaration 
	|	cursor_spec 
	|	procedure_spec 
	|	function_spec 
	|	exception_declaration 
	|	pragma_declaration
	;

variable_declaration
        :	variable_name opt_constant
                type_spec opt_not_null
                opt_var_def_val PLS_SEMI
        ;

opt_constant
        :       'CONSTANT'
        |
        ;

opt_not_null
        :       not_null
        |
        ;

not_null
        :       'NOT' 'NULL'
        ;

opt_var_def_val
        :       assign_or_default plsql_expression
        |
        ;

assign_or_default
        :      PLS_ASSIGN
        |
               'DEFAULT'
        ;

type_declaration 
        :	type type_spec 'IS' opt_new type_spec_opt_not_null_or_parenthesized_plsql_expressions PLS_SEMI
        ;

type_spec_opt_not_null_or_parenthesized_plsql_expressions
        :       type_spec_opt_not_null
        |       parenthesized_plsql_expressions
        ;

type_spec_opt_not_null
        :       type_spec opt_not_null
        ;

opt_new
        :       'NEW'
        |
        ;

subtype_declaration 
        :	'SUBTYPE' type_spec 'IS' type_spec opt_not_null_or_range PLS_SEMI
	;	

opt_not_null_or_range
        :       not_null_or_range
        |
        ;

not_null_or_range
        :       not_null
        |       'RANGE' literal PLS_DOUBLEDOT literal
        ;
	
cursor_declaration
        :	'CURSOR' cursor_name
                opt_parenthesized_parameter_specs
                'IS' select_command PLS_SEMI
	;

package_obj_body
	:	variable_declaration 
	|	subtype_declaration 
	|	cursor_declaration 
	|	exception_declaration 
	|	record_declaration 
	|	plsql_table_declaration 
	|	varray_declaration
	|	procedure_body 
	|	function_body 
	|	pragma_declaration
	;

seq_of_statements
        :	statement_and_semi
        |       seq_of_statements statement_and_semi
	;

statement_and_semi
        :       statement PLS_SEMI
        ;

statement
	:	assignment_statement
	|	exit_statement
	|	goto_statement
	|	case_statement
	|	if_statement 
	|	loop_statement 
	|	null_statement
	|	raise_statement
	|	return_statement
	|	sql_statement
	|	plsql_block

	|	function_call
	;
		
plsql_block
        :	opt_block_label
                opt_declare_block
                'BEGIN'
		seq_of_statements
                opt_exception_block
                'END' opt_label_name
	;

opt_label_name
        :       label_name
        |
        ;

opt_exception_block
        :       'EXCEPTION' exception_handlers
        |
        ;

exception_handlers
        :       exception_handler
        |       exception_handlers exception_handler
        ;

opt_block_label
        :       PLS_LLABEL label_name PLS_RLABEL
        |
        ;

opt_declare_block
        :       opt_declare declare_specs
        |
        ;

opt_declare
        :       'DECLARE'
        |
        ;

declare_specs
        :       declare_spec
        |       declare_specs declare_spec
        ;

kleene_declare_specs
        :       kleene_declare_specs declare_specs
        |
        ;

declare_spec
	:	variable_declaration 
	|	subtype_declaration 
	|	cursor_declaration 
	|	exception_declaration 
	|	record_declaration 
	|	plsql_table_declaration 
	|	varray_declaration
	|	procedure_declaration 
	|	function_declaration
	|	type_declaration 
	|	pragma_declaration
	;

pragma_declaration
        :	'PRAGMA' pragma_body PLS_SEMI
	;

pragma_body
        :       'RESTRICT_REFERENCES' PLS_LPAREN default_or_function_name tail_pragma_params PLS_RPAREN
        |	'EXCEPTION_INIT' PLS_LPAREN exception_name PLS_COMMA literal PLS_RPAREN
        |	'AUTONOMOUS_TRANSACTION'
        |	'SERIALLY_REUSABLE'
        |	'BUILTIN' PLS_LPAREN pragma_params PLS_RPAREN
        |	'FIPSFLAG' PLS_LPAREN pragma_params PLS_RPAREN
        |	'INTERFACE' PLS_LPAREN pragma_params PLS_RPAREN
        |	'NEW_NAMES' PLS_LPAREN pragma_params PLS_RPAREN
        |	'TIMESTAMP' PLS_LPAREN pragma_params PLS_RPAREN
        ;

default_or_function_name
        :       'DEFAULT'
        |
                function_name
        ;

pragma_params
        :	pragma_param kleene_tail_pragma_params
	;

tail_pragma_param
        :       PLS_COMMA pragma_param
        ;

tail_pragma_params
        :       tail_pragma_param
        |       tail_pragma_params tail_pragma_param
        ;

kleene_tail_pragma_params
        :       kleene_tail_pragma_params tail_pragma_param
        |
        ;

pragma_param
        :	opt_plus_minus PLS_NUMBER
        |	PLS_QUOTED_STRING
	|	identifier
	;

opt_plus_minus
        :       plus_minus
        |
        ;

plus_minus
        :       PLS_PLUS
        |
                PLS_MINUS
        ;

assignment_statement
        :

                lvalue PLS_ASSIGN plsql_expression

	;
lvalues
        :	lvalue kleene_tail_lvalues
	;

tail_lvalue
        :       PLS_COMMA lvalue
        ;

kleene_tail_lvalues
        :       kleene_tail_lvalues tail_lvalue
        |
        ;



lvalue
	:	variable_name
        |	record_name PLS_DOT field_name
        |	plsql_table_name PLS_LPAREN subscript PLS_RPAREN kleene_tail_field_name
        |	full_host_variable opt_full_host_variable
	;

tail_field_name
        :       PLS_DOT field_name
        ;

kleene_tail_field_name
        :       kleene_tail_field_name tail_field_name
        |
        ;

field_name
	:	identifier
	;
	
subscript
	:	plsql_expression 
	;

opt_full_host_variable
        :       full_host_variable
        |
        ;

full_host_variable
        :       PLS_COLON host_variable
        ;
	
host_variable
	:	identifier
	;
	
goto_statement
	:	'GOTO' label_name
	;
	
label_name
	:	identifier
	;	

exit_statement
        :	'EXIT' opt_label_name opt_when_plsql_condition
	;

when_plsql_condition
        :       'WHEN' plsql_condition
        ;

opt_when_plsql_condition
        :       when_plsql_condition
        |
        ;
	
datatype
	:	'BINARY_INTEGER' 
	|	'BINARY_FLOAT'
	|	'BINARY_DOUBLE'
	|	'NATURAL' 
	|	'POSITIVE' 
        |	number_with_precision_datatype opt_number_precision
        |	'LONG' opt_datatype_precision
        |	'LONG' 'RAW' opt_datatype_precision
        |	'RAW' opt_datatype_precision
	|	'BOOLEAN'
	|	'DATE'
        |	'INTERVAL' 'DAY' opt_datatype_precision 'TO' 'SECOND' opt_datatype_precision
        |	'INTERVAL' 'YEAR' opt_datatype_precision 'TO' 'MONTH'
        |	time_or_timestamp opt_datatype_precision opt_timezone_spec
	|	'INTEGER'
	|	'INT'
	|	'SMALLINT'
        |	'FLOAT' opt_datatype_precision
	|	'REAL'
        |	'DOUBLE' 'PRECISION'
        |	'CHAR'      opt_varying opt_char_precision opt_character_set_spec
        |	'VARCHAR'                   opt_char_precision opt_character_set_spec
        |	'VARCHAR2'                  opt_char_precision opt_character_set_spec
        |	'CHARACTER' opt_varying opt_datatype_precision
        |	'NCHAR'     opt_varying opt_datatype_precision
        |	'NVARCHAR'  opt_datatype_precision
        |	'NVARCHAR2' opt_datatype_precision
        |	'NATIONAL'  character_or_char opt_varying opt_datatype_precision
	|	'MLSLABEL'
	|	'PLS_INTEGER'
	|	'BLOB'
        |	'CLOB' opt_character_set_spec
	|	'NCLOB'
	|	'BFILE'
	|	'ROWID' 
        |	'UROWID' opt_datatype_precision
	;

opt_character_set_spec
        :       character_set_spec
        |
        ;

character_set_spec
        :       'CHARACTER' 'SET' charset_name_or_column_charset
        ;

charset_name_or_column_charset
        :       identifier
        |       column_spec charset_attr
        ;

character_or_char
        :       'CHARACTER'
        |       'CHAR'
        ;

opt_varying
        :       varying
        |
        ;

varying
        :       'VARYING'
        ;

timezone_spec
        :       'WITH' opt_timezone_local_spec 'TIME' 'ZONE'
        ;

opt_timezone_spec
        :       timezone_spec
        |
        ;

timezone_local_spec
        :       'LOCAL'
        ;

opt_timezone_local_spec
        :       timezone_local_spec
        |
        ;

time_or_timestamp
        :       'TIME'
        |       'TIMESTAMP'
        ;

opt_datatype_precision
        :       datatype_precision
        |
        ;

datatype_precision
        :       PLS_LPAREN PLS_NUMBER PLS_RPAREN
        ;

char_precision
        :       PLS_LPAREN PLS_NUMBER opt_byte_or_char PLS_RPAREN
        ;

opt_char_precision
        :       char_precision
        |
        ;

byte_or_char
        :       'BYTE'
        |       'CHAR'
        ;

opt_byte_or_char
        :       byte_or_char
        |
        ;

number_with_precision_datatype
        :       'PLS_NUMBER'
        |       'NUMERIC'
        |       'DECIMAL'
        |       'DEC'
        ;

number_precision
        :       PLS_LPAREN PLS_NUMBER opt_tail_precision PLS_RPAREN
        ;

opt_number_precision
        :       number_precision
        |
        ;

tail_precision
        :       PLS_COMMA PLS_NUMBER
        ;

opt_tail_precision
        :       tail_precision
        |
        ;

type_spec
	:	datatype 
        |	column_spec type_attr
        |	table_spec rowtype_attr
        |	type_name opt_datatype_precision
	;

opt_type_spec
        :       type_spec
        |
        ;

type_name
        :	sql_identifiers
	;

tail_identifier
        :       PLS_DOT identifier
        ;

kleene_tail_identifiers
        :       kleene_tail_identifiers tail_identifier
        |
        ;

parameter_specs
        :	parameter_spec kleene_tail_parameter_specs
	;

tail_parameter_spec
        :       PLS_COMMA parameter_spec
        ;

kleene_tail_parameter_specs
        :       kleene_tail_parameter_specs tail_parameter_spec
        |
        ;

parameter_spec
        :	parameter_name opt_in opt_type_spec
        ;

in
        :       'IN'
        ;

opt_in
        :       in
        |
        ;

parameter_name
	:	identifier
	;

cursor_spec
        :	'CURSOR' cursor_name
                opt_parenthesized_parameter_specs
                return return_type PLS_SEMI
	;

parenthesized_parameter_specs
        :       PLS_LPAREN parameter_specs PLS_RPAREN
        ;

opt_parenthesized_parameter_specs
        :       parenthesized_parameter_specs
        |
        ;

procedure_spec: 
	'PROCEDURE' procedure_name 
        opt_parenthesized_arguments PLS_SEMI
	;

parenthesized_arguments
        :       PLS_LPAREN arguments PLS_RPAREN
        ;

opt_parenthesized_arguments
        :       parenthesized_arguments
        |
        ;

function_spec
	:	'FUNCTION' function_name 
                opt_parenthesized_arguments
                return return_type PLS_SEMI
	;

exception_declaration
        :	exception_name 'EXCEPTION' PLS_SEMI
	;

exception_names
        :	exception_name kleene_tail_exception_names
	;

tail_exception_name
        :       'OR' exception_name
        ;

kleene_tail_exception_names
        :       kleene_tail_exception_names tail_exception_name
        |
        ;

opt_exception_name
        :       exception_name
        |
        ;

exception_name
        :	opt_exception_name_prefix identifier
	;

exception_name_prefix
        :       exception_package_name PLS_DOT
        ;

opt_exception_name_prefix
        :       exception_name_prefix
        |
        ;

exception_package_name
	:	identifier
	;

record_declaration
	:	record_type_dec 

	;

record_type_dec
        :	type type_name 'IS' 'RECORD'
                PLS_LPAREN field_specs PLS_RPAREN PLS_SEMI
	;

field_specs
        :	field_spec kleene_tail_field_specs
	;

tail_field_spec
        :       PLS_COMMA field_spec
        ;

kleene_tail_field_specs
        :       kleene_tail_field_specs tail_field_spec
        |
        ;

field_spec
	:	column_name type_spec
                opt_not_null
                opt_default_value_assignment
	;

pls_assign_or_default
        :       PLS_ASSIGN
        |       'DEFAULT'
        ;

default_value_assignment
        :       pls_assign_or_default plsql_expression
        ;

opt_default_value_assignment
        :       default_value_assignment
        |
        ;

plsql_table_declaration
	:	table_type_dec

	;

table_type_dec
        :	type type_name 'IS' 'TABLE'
                of type_spec opt_not_null
                opt_index_by
                PLS_SEMI
	;

index_by
        :       'INDEX' 'BY' index_by_type
        ;

index_by_type
        :       'BINARY_INTEGER'
        |	'PLS_INTEGER'
        |	'VARCHAR2' PLS_LPAREN integer PLS_RPAREN
        ;

opt_index_by
        :       index_by
        |
        ;

table_var_dec
        :	plsql_table_name type_name PLS_SEMI
        ;

plsql_table_name
        :	identifier kleene_tail_identifiers
	;

varray_declaration
        :	type type_name 'IS'
                varray_or_varying_array PLS_LPAREN integer PLS_RPAREN
                of type_spec opt_not_null
	;

varray_or_varying_array
        :       'VARRAY'
        |       'VARYING' 'ARRAY'
        ;

procedure_declaration
	:	procedure_body
	;

procedure_body
        :	opt_proc_fun_start 'PROCEDURE' procedure_name
                opt_parenthesized_arguments
                is_or_as

                kleene_declare_specs
                begin_block
                opt_procedure_name PLS_SEMI
	;

begin_block
	:	'BEGIN'
                seq_of_statements
                opt_exception_block
		'END'
	;

opt_procedure_name
        :       procedure_name
        |
        ;


exception_handler
	:	'WHEN' exception_names 'THEN'
		seq_of_statements
	;

proc_fun_start
        :	'CREATE' opt_or_replace
	;

opt_proc_fun_start
        :       proc_fun_start
        |
        ;

function_body
:               opt_proc_fun_start 'FUNCTION' function_name
                opt_parenthesized_arguments
                return return_type is_or_as

                kleene_declare_specs
                begin_block
                opt_function_name PLS_SEMI
	;

opt_function_name
        :       function_name
        |
        ;

function_name
        :	identifier | PLS_QUOTED_STRING
	;

procedure_name
        :	identifier | PLS_QUOTED_STRING
	;

arguments
        :	argument kleene_tail_arguments
	;

tail_argument
        :       PLS_COMMA argument
        ;

kleene_tail_arguments
        :       kleene_tail_arguments tail_argument
        |
        ;

argument
        :	argument_name opt_argument_direction opt_argument_type
                opt_var_def_val
	;

argument_direction
        :       'OUT'
        |       'IN' 'OUT'
        |       'IN'
        ;

opt_argument_direction
        :       argument_direction
        |
        ;

argument_name
	:	identifier
	;

opt_argument_type
        :       argument_type
        |
        ;

argument_type
	:	type_spec
	;

value
        :	opt_plus_minus PLS_NUMBER
	|	quoted_string
	|	'TRUE' | 'FALSE'
	|	'NULL'
	;

return_type
	:	type_spec
	;

function_declaration
	:	function_body
	;

function_call
        :	user_defined_function opt_parenthesized_opt_call_parameters
	;

collection_function_call
	:	plsql_table_name
	;

variable_names
        :	variable_name kleene_tail_variable_names
	;

tail_variable_name
        :       PLS_COMMA variable_name
        ;

kleene_tail_variable_names
        :       kleene_tail_variable_names tail_variable_name
        |
        ;

variable_name
	:	identifier
	;

null_statement
	:	'NULL' 
	;

raise_statement
        :	'RAISE' opt_exception_name
	;
	
return_statement
        :	return opt_plsql_expression
	;

loop_statement
        :	opt_block_label
                opt_while_or_for_condition
                'LOOP'
		seq_of_statements
                'END' 'LOOP'
                opt_label_name
	;

opt_while_or_for_condition
        :       while_or_for_condition
        |
        ;

while_or_for_condition
        :       while_condition
        |       for_condition
        ;

while_condition
        :       'WHILE' plsql_condition
        ;

for_condition
        :       'FOR' numeric_or_cursor_loop_param
        ;

numeric_or_cursor_loop_param
        :       numeric_loop_param
        |       cursor_loop_param
        ;

numeric_loop_param
        :	index_name in opt_reverse integer_expr PLS_DOUBLEDOT integer_expr
	;

opt_reverse
        :       reverse
        |
        ;

reverse
        :       'REVERSE'
        ;

index_name
	:	identifier
	;


integer_expr
	:	sql_expression
	;

cursor_name
	:	identifier
	;

cursor_loop_param
        :	record_name 'IN' cursor_def
        ;

cursor_def
        :       cursor_name opt_parenthesized_plsql_expressions
        |	PLS_LPAREN select_statement PLS_RPAREN
        ;

record_name
	:	identifier
	;

commit_statement
	:	'COMMIT'
	;

if_statement
        :	'IF' plsql_condition 'THEN' seq_of_statements
                kleene_elsif_clauses
                opt_else_clause
		'END' 'IF'
	;

elsif_clause
        :       'ELSIF' plsql_condition 'THEN' seq_of_statements
        ;

kleene_elsif_clauses
        :       kleene_elsif_clauses elsif_clause
        |
        ;

else_clause
        :       'ELSE' seq_of_statements
        ;

opt_else_clause
        :       else_clause
        |
        ;

sql_statement
	:	sql_command
	;

sql_command
	:	to_modify_data
	|	to_control_data
	;

to_modify_data
	:	select_command
	|	insert_command
	|	update_command
	|	delete_command
	|	set_transaction_command
	;

to_control_data
	:	close_statement
	|	commit_statement
	|	fetch_statement
	|	lock_table_statement
	|	open_statement
	|	rollback_statement
	|	savepoint_statement
	;

sql_expression_or_parenthesized_select_command
        :       sql_expression
        |       parenthesized_select_command
        ;

parenthesized_select_command
        :       PLS_LPAREN select_command PLS_RPAREN
        ;

select_command
        :	select_statement
	;

select_statement
        :
		select_expression 
	;

select_expression
	:	
                'SELECT' opt_distinct_or_unique_or_all select_list
                opt_bulk_collect
                opt_into_clause
                from from_part
                opt_where_clause opt_hierarchical_query_clause opt_group_by_clause
                opt_having_clause opt_model_clause
                opt_union_or_intersect_or_minus_part
                opt_order_by_clause
	;

opt_union_or_intersect_or_minus_part
        :       union_or_intersect_or_minus_part
        |
        ;

union_or_intersect_or_minus_part
        :       union_or_intersect_or_minus select_expression_or_subquery
        ;

select_expression_or_subquery
        :       select_expression
        |	subquery
        ;

union_or_intersect_or_minus
        :       'UNION' opt_all
        |	'INTERSECT'
        |	'PLS_MINUS'
        ;

opt_all
        :       all
        |
        ;

all
        :       'ALL'
        ;

opt_having_clause
        :       having_clause
        |
        ;

having_clause
        :       'HAVING' sql_condition
        ;

from_part
        :       table_reference_list
        |       join_clause
        |       PLS_LPAREN join_clause PLS_RPAREN
        ;

opt_into_clause
        :       into_clause
        |
        ;

into_clause
        :       'INTO' lvalues
        ;

opt_bulk_collect
        :       bulk_collect
        |
        ;

bulk_collect
        :       'BULK' 'COLLECT'
        ;

opt_distinct_or_unique_or_all
        :       distinct_or_unique_or_all
        |
        ;

distinct_or_unique_or_all
        :       'DISTINCT'
        |       'UNIQUE'
        |       'ALL'
        ;

select_list
        :	PLS_ASTERISK
        |	displayed_column kleene_tail_displayed_columns
	;

kleene_tail_displayed_columns
        :       kleene_tail_displayed_columns tail_displayed_column
        |
        ;

tail_displayed_column
        :       PLS_COMMA displayed_column
        ;

table_reference_list_from
        :	from table_reference_list
	;

table_reference_list
        :	selected_table kleene_tail_selected_tables
	;

kleene_tail_selected_tables
        :       kleene_tail_selected_tables tail_selected_table
        |
        ;

tail_selected_table
        :       PLS_COMMA selected_table
        ;

join_clause
        :	table_name inner_or_outer_join_clauses
	;

inner_or_outer_join_clauses
        :       inner_or_outer_join_clause
        |       inner_or_outer_join_clauses inner_or_outer_join_clause
        ;

inner_or_outer_join_clause
        :       inner_cross_join_clause
        |       outer_join_clause
        ;

inner_cross_join_clause
        :	opt_inner 'JOIN' table_name join_condition
        |	cross_or_natural_inner 'JOIN' table_name
	;

cross_or_natural_inner
        :       'CROSS'
        |       'NATURAL' inner
        ;

opt_join_condition
        :       join_condition
        |
        ;

join_condition
        :       'ON' sql_condition
        |       'USING' parenthesized_column_specs
        ;

inner
        :       'INNER'
        ;

opt_inner
        :       inner
        |
        ;

outer_join_clause
        :	opt_query_partition_clause
                outer_or_natural_outer_join
                table_name opt_query_partition_clause
                opt_join_condition
	;

outer_or_natural_outer_join
        :       outer_join_type 'JOIN'
        |	'NATURAL' opt_outer_join_type 'JOIN'
        ;

opt_query_partition_clause
        :       query_partition_clause
        |
        ;

query_partition_clause
        :	'PARTITION' 'BY' expression_list
	;
opt_outer_join_type
        :       outer_join_type
        |
        ;
outer_join_type
        :	full_or_left_or_right opt_outer
	;

full_or_left_or_right
        :       'FULL'
        |       'LEFT'
        |       'RIGHT'
        ;

opt_outer
        :       outer
        |
        ;

outer
        :       'OUTER'
        ;

opt_outer_join_sign
        :       outer_join_sign
        |
        ;

outer_join_sign
        :	PLS_LPAREN PLS_PLUS PLS_RPAREN
	;

opt_where_clause
        :       where_clause
        |
        ;

where_clause
	:	'WHERE' sql_condition
	;

opt_hierarchical_query_clause
        :       hierarchical_query_clause
        |
        ;

hierarchical_query_clause
        :	opt_start_with_sql_condition 'CONNECT' 'BY' opt_nocycle sql_condition
	;

opt_nocycle
        :       nocycle
        |
        ;

nocycle
        :       'NOCYCLE'
        ;

opt_start_with_sql_condition
        :       start_with_sql_condition
        |
        ;

start_with_sql_condition
        :       'START' 'WITH' sql_condition
        ;

opt_group_by_clause
        :       group_by_clause
        |
        ;

group_by_clause
	:	'GROUP' 'BY' group_by_exprs
	;
group_by_exprs
        :	group_by_expr kleene_tail_group_by_exprs
	;

kleene_tail_group_by_exprs
        :       kleene_tail_group_by_exprs tail_group_by_expr
        |
        ;

tail_group_by_expr
        :       PLS_COMMA group_by_expr
        ;

group_by_expr
	:	rollup_cube_clause
	|	grouping_sets_clause
	|	grouping_expression_list
	;
rollup_cube_clause
        :	rollup_or_cube PLS_LPAREN grouping_expression_list PLS_RPAREN
	;

rollup_or_cube
        :       'ROLLUP' | 'CUBE'
        |
        ;

grouping_sets_clause
        :	'GROUPING' 'SETS' PLS_LPAREN grouping_expression_list PLS_RPAREN
	;
grouping_sets_exprs
        :	grouping_sets_expr kleene_tail_grouping_sets_exprs
	;

kleene_tail_grouping_sets_exprs
        :       kleene_tail_grouping_sets_exprs tail_grouping_sets_expr
        |
        ;

tail_grouping_sets_expr
        :       PLS_COMMA grouping_sets_expr
        ;

grouping_sets_expr
	:	rollup_cube_clause | grouping_expression_list
	;

opt_model_clause
        :       model_clause
        |
        ;

model_clause
        :	'MODEL' cell_reference_options
                opt_return_rows_clause
                reference_models main_model
	;
cell_reference_options
        :	opt_ignore_or_keep_nav
                opt_unique_dimension_or_single_reference
	;

opt_unique_dimension_or_single_reference
        :       unique_dimension_or_single_reference
        |
        ;

unique_dimension_or_single_reference
        :       'UNIQUE' dimension_or_single_reference
        ;

dimension_or_single_reference
        :       'DIMENSION'
        |       'SINGLE' 'REFERENCE'
        ;

opt_ignore_or_keep_nav
        :       ignore_or_keep_nav
        |
        ;

ignore_or_keep_nav
        :       ignore_or_keep 'NAV'
        ;

ignore_or_keep
        :       'IGNORE'
        |       'KEEP'
        ;

opt_return_rows_clause
        :       return_rows_clause
        |
        ;

return_rows_clause
        :	return updated_or_all 'ROWS'
	;

updated_or_all
        :       'UPDATED'
        |       'ALL'
        ;

reference_models
        :       reference_models reference_model
        |       reference_model
        ;

reference_model
        :	'REFERENCE' reference_model_name 'ON' PLS_LPAREN subquery PLS_RPAREN
                model_column_clauses cell_reference_options
	;
reference_model_name
	:	identifier
	;
main_model
        :	opt_main_main_model_name model_column_clauses
                cell_reference_options model_rules_clause
	;

opt_main_main_model_name
        :       main_main_model_name
        |
        ;

main_main_model_name
        :       'MAIN' main_model_name
        ;

main_model_name
	:	identifier
	;
model_column_clauses
        :	opt_query_partition_clause_opt_column_spec
                'DIMENSION' 'BY' PLS_LPAREN model_columns PLS_RPAREN
                'MEASURES' PLS_LPAREN model_columns PLS_RPAREN
	;

opt_query_partition_clause_opt_column_spec
        :       query_partition_clause_opt_column_spec
        |
        ;

query_partition_clause_opt_column_spec
        :       query_partition_clause opt_column_spec
        ;

model_columns
        :	model_column kleene_tail_model_columns
	;

kleene_tail_model_columns
        :       kleene_tail_model_columns tail_model_column
        |
        ;

tail_model_column
        :       PLS_COMMA model_column
        ;

model_column
        :	sql_expression opt_opt_as_column_spec
	;

opt_opt_as_column_spec
        :       opt_as_column_spec
        |
        ;

opt_as_column_spec
        :       opt_as column_spec
        |
        ;

opt_as
        :       as
        |
        ;

as
        :       'AS'
        ;

model_rules_clause
        :	opt_model_rules_clause_rules
                opt_model_rules_clause_iterate
                PLS_LPAREN model_rules_exprs PLS_RPAREN
	;

opt_model_rules_clause_iterate
        :       model_rules_clause_iterate
        |
        ;

model_rules_clause_iterate
        :       'ITERATE' PLS_LPAREN PLS_NUMBER PLS_RPAREN opt_until_condition_paren
        ;

opt_until_condition_paren
        :       until_condition_paren
        |
        ;

until_condition_paren
        :       'UNTIL' condition_paren
        ;

opt_model_rules_clause_rules
        :       model_rules_clause_rules
        |
        ;

model_rules_clause_rules
        :       'RULES' opt_update_or_upsert_opt_all opt_automatic_or_sequential_order
        ;

opt_automatic_or_sequential_order
        :       automatic_or_sequential_order
        |
        ;

automatic_or_sequential_order
        :       automatic_or_sequential_order 'ORDER'
        ;

automatic_or_sequential
        :       'AUTOMATIC'
        |       'SEQUENTIAL'
        ;

opt_update_or_upsert_opt_all
        :       update_or_upsert_opt_all
        |
        ;

update_or_upsert_opt_all
        :       'UPDATE'
        |       'UPSERT' opt_all
        ;

model_rules_exprs
        :	model_rules_expr kleene_tail_model_rules_exprs
	;

kleene_tail_model_rules_exprs
        :       kleene_tail_model_rules_exprs tail_model_rules_expr
        |
        ;

tail_model_rules_expr
        :       PLS_COMMA model_rules_expr
        ;

model_rules_expr
        :	opt_update_or_upsert_opt_all cell_assignment opt_order_by_clause PLS_EQ sql_expression
	;
cell_assignment
        :	measure_column PLS_LBRACK multi_column_for_loop_or_cell_assignment_exprs PLS_RBRACK
	;

multi_column_for_loop_or_cell_assignment_exprs
        :       multi_column_for_loop
        |       cell_assignment_exprs
        ;

cell_assignment_exprs
        :	cell_assignment_expr kleene_tail_cell_assignment_exprs
	;

kleene_tail_cell_assignment_exprs
        :       kleene_tail_cell_assignment_exprs tail_cell_assignment_expr
        |
        ;

tail_cell_assignment_expr
        :       PLS_COMMA cell_assignment_expr
        ;

cell_assignment_expr
	:	sql_condition | sql_expression | single_column_for_loop
	;
measure_column
	:	column_name
	;
single_column_for_loop
	:	'FOR' column_name
                single_column_for_loop_in_part
	;

single_column_for_loop_in_part
        :       'IN' PLS_LPAREN literals_or_subquery PLS_RPAREN
        |	opt_like_pattern from literal 'TO' literal increment_or_decrement literal
        ;

increment_or_decrement
        :       'INCREMENT'
        |       'DECREMENT'
        ;


opt_like_pattern
        :       like_pattern
        |
        ;

like_pattern
        :       'LIKE' pattern
        ;

literals_or_subquery
        :       literals
        |       subquery
        ;

literal
        :	opt_plus_minus PLS_NUMBER
        |	PLS_QUOTED_STRING
	;
literals
        :	literal kleene_tail_literals
	;

kleene_tail_literals
        :       kleene_tail_literals tail_literal
        |
        ;

tail_literal
        :       PLS_COMMA literal
        ;

bracket_literals
        :	PLS_LPAREN literals PLS_RPAREN
	;
bracket_literals_list
        :	bracket_literals kleene_tail_bracket_literals
	;

kleene_tail_bracket_literals
        :       kleene_tail_bracket_literals tail_bracket_literals
        |
        ;

tail_bracket_literals
        :       PLS_COMMA bracket_literals
        ;


pattern
        :	PLS_QUOTED_STRING
	;
multi_column_for_loop
        :	'FOR' parenthesized_column_specs 'IN' PLS_LPAREN bracket_literals_list_or_subquery PLS_RPAREN
	;

bracket_literals_list_or_subquery
        :       bracket_literals_list
        |       subquery
        ;

opt_order_by_clause
        :       order_by_clause
        |
        ;

order_by_clause
        :	'ORDER' opt_siblings 'BY' order_by_exprs
	;

opt_siblings
        :       siblings
        |
        ;

siblings
        :       'SIBLINGS'
        ;

order_by_exprs
        :	order_by_expr opt_tail_order_by_exprs
	;

opt_tail_order_by_exprs
        :       opt_tail_order_by_exprs tail_order_by_expr
        |
        ;

tail_order_by_expr
        :       PLS_COMMA order_by_expr
        ;

order_by_expr
        :	sql_expression
                opt_asc_or_desc opt_nulls_first_or_last
	;

opt_nulls_first_or_last
        :       nulls_first_or_last
        |
        ;

nulls_first_or_last
        :       'NULLS' 'FIRST'
        |       'NULLS' 'LAST'
        ;

opt_asc_or_desc
        :       asc_or_desc
        |
        ;

asc_or_desc
        :       'ASC'
        |       'DESC'
        ;

for_update_clause
        :	'FOR' 'UPDATE' opt_of_column_specs opt_wait_or_nowait
	;

opt_wait_or_nowait
        :       wait_or_nowait
        |
        ;

wait_or_nowait
        :       'WAIT' integer
        |       nowait
        ;

opt_nowait
        :       nowait
        |
        ;

nowait
        :       'NOWAIT'
        ;

opt_of_column_specs
        :       of_column_specs
        |
        ;

of_column_specs
        :       of column_specs
        ;

where_condition_whole
	:	'WHERE' sql_condition
	;

where_condition
	:	sql_condition
	;

displayed_column
        :	column_spec_dot_asterisk_or_sql_expression
                opt_alias
	;

column_spec_dot_asterisk_or_sql_expression
        :       column_spec PLS_DOT PLS_ASTERISK
        |       sql_expression
        ;

schema_name
        :	sql_identifier
	;

table_name
        :	sql_identifier
	;

nested_expressions
        :	nested_expression kleene_tail_nested_expressions
	;

kleene_tail_nested_expressions
        :       kleene_tail_nested_expressions tail_nested_expression
        |
        ;

opt_dot_nested_expression
        :       dot_nested_expression
        |
        ;

dot_nested_expression
        :       PLS_DOT nested_expression
        ;

tail_nested_expression
        :       PLS_COMMA nested_expression
        ;

parenthesized_or_simple_nested_expression
        :       parenthesized_nested_expression
        |       nested_expression
        ;

parenthesized_nested_expression
        :       PLS_LPAREN nested_expression PLS_RPAREN
        ;

nested_expression
        :	sql_expression
        |	plsql_expression
	;
plsql_condition

	:	expr_bool
	;

opt_parenthesized_plsql_expressions
        :       parenthesized_plsql_expressions
        |
        ;

parenthesized_plsql_expressions
        :       PLS_LPAREN plsql_expressions PLS_RPAREN
        ;

plsql_expressions
        :	plsql_expression kleene_tail_plsql_expressions
	;

tail_plsql_expression
        :       PLS_COMMA plsql_expression
        ;

kleene_tail_plsql_expressions
        :       kleene_tail_plsql_expressions tail_plsql_expression
        |
        ;

opt_plsql_expression
        :       plsql_expression
        |
        ;

plsql_expression

	:	expr_bool
	;


expr_bool
        :	expr_or kleene_tail_expr_ors
	;

kleene_tail_expr_ors
        :       kleene_tail_expr_ors tail_expr_or
        |
        ;

tail_expr_or
        :       'OR' expr_or
        ;

expr_or
        :	expr_and kleene_tail_expr_ands
	;

kleene_tail_expr_ands
        :       kleene_tail_expr_ands tail_expr_and
        |
        ;

tail_expr_and
        :       'AND' expr_and
        ;

expr_and
        :	opt_not expr_not
	;

opt_not
        :       not
        |
        ;

not
        :       'NOT'
        ;

expr_not
	:	expr_add 
                kleene_expr_not_second_parts
	;

kleene_expr_not_second_parts
        :       kleene_expr_not_second_parts expr_not_second_part
        |
        ;

expr_not_second_part
        :       relational_op expr_add
        |	cursor_attribute
        |	'IS' opt_not 'NULL'
        |	opt_not 'LIKE' expr_add
        |	opt_not 'BETWEEN' expr_add 'AND' expr_add
        |	opt_not 'IN' PLS_LPAREN nested_expressions PLS_RPAREN
        ;

boolean_literal
	:	'TRUE' | 'FALSE'
	;

sql_expressions
        :	sql_expression kleene_tail_sql_expressions
	;

kleene_tail_sql_expressions
        :       kleene_tail_sql_expressions tail_sql_expression
        |
        ;

tail_sql_expression
        :       PLS_COMMA sql_expression
        ;

sql_expression

	:	expr_add
	;
expr_add
        :	expr_mul kleene_add_ops_expr_muls
	;

kleene_add_ops_expr_muls
        :       kleene_add_ops_expr_muls add_ops_expr_mul
        |
        ;

add_ops_expr_mul
        :       add_ops expr_mul
        ;

add_ops
        :       PLS_PLUS | PLS_MINUS | PLS_DOUBLEVERTBAR
        ;


expr_mul
        :	expr_sign kleene_asterisk_or_divide_expr_signs
	;

kleene_asterisk_or_divide_expr_signs
        :       kleene_asterisk_or_divide_expr_signs asterisk_or_divide_expr_sign
        |
        ;

asterisk_or_divide_expr_sign
        :       asterisk_or_divide expr_sign
        ;

asterisk_or_divide
        :       PLS_ASTERISK
        |       PLS_DIVIDE
        ;

expr_sign
        :	opt_plus_minus expr_pow
	;
expr_pow
        :	expr_expr kleene_exponent_expr_exprs
	;

kleene_exponent_expr_exprs
        :       kleene_exponent_expr_exprs exponent_expr_expr
        |
        ;


exponent_expr_expr
        :       PLS_EXPONENT expr_expr
        ;

expr_expr
        :	 expr_paren
        |	 function_expression
        |	 case_expression
        |	 cursor_expression
        |	 simple_expression
        |	 select_expression
	;
simple_expression
	:	boolean_literal
        |	'SQL' cursor_attribute
        |	 column_spec
        |	PLS_QUOTED_STRING
        |	PLS_NUMBER



	|	'NULL'
	;

cursor_attribute
        :       '%FOUND'
        |       '%NOTFOUND'
        |       '%ISOPEN'
        |       '%ROWCOUNT'
        |       '%BULK_ROWCOUNT'
        ;

compound_expression
	:	expr_prior
	;
expr_paren
        :	PLS_LPAREN nested_expression PLS_RPAREN
	;
expr_prior
        :	prior expr_add
	;
case_expression
        :	'CASE' simple_case_expression_or_searched_case_expression opt_else_case_expression 'END'
	;

simple_case_expression_or_searched_case_expression
        :       simple_case_expression
        |       searched_case_expression
        ;
simple_case_expression
        :	nested_expression when_then_expressions
	;
when_then_expressions
        :       when_then_expressions when_then_expression
        |       when_then_expression
        ;
when_then_expression
        :       'WHEN' nested_expression 'THEN' nested_expression
        ;
searched_case_expression
        :	when_conditions_then_expressions
	;
when_conditions_then_expressions
        :       when_conditions_then_expressions when_condition_then_expression
        |       when_condition_then_expression
        ;
when_condition_then_expression
        :       'WHEN' nested_condition 'THEN' nested_expression;
else_case_expression
	:	'ELSE' nested_expression
	;
case_statement
        :	opt_label_name 'CASE' simple_case_statement_or_searched_case_statement opt_else_case_statement 'END' 'CASE' opt_label_name
	;
simple_case_statement_or_searched_case_statement
        :       simple_case_statement
        |       searched_case_statement
        ;
simple_case_statement
        :	plsql_expression when_plsqls_then_seq_of_statements
	;
when_plsqls_then_seq_of_statements
        :       when_plsqls_then_seq_of_statements when_plsql_then_seq_of_statements
        |       when_plsql_then_seq_of_statements
        ;

when_plsql_then_seq_of_statements
        :       'WHEN' plsql_expression 'THEN' seq_of_statements
        ;
searched_case_statement
        :	'WHEN' plsql_expression 'THEN' seq_of_statements
	;
opt_else_case_expression
        :       else_case_expression
        |
        ;
opt_else_case_statement
        :       else_case_statement
        |
        ;

else_case_statement
	:	'ELSE' seq_of_statements
	;
cursor_expression
        :	'CURSOR' PLS_LPAREN subquery PLS_RPAREN
	;
datetime_expression
	:	sql_expression 'AT'
                full_timezone_spec
	;

full_timezone_spec
        :       'LOCAL'
        |	'TIME' 'ZONE' timezone_spec
        ;

timezone_spec
        :       'DBTIMEZONE' | 'SESSIONTIMEZONE' | sql_expression
        ;

function_expression
        :	function_call opt_dot_nested_expression
        |       count_or_distinct_nested_expression
	;

count_or_distinct_nested_expression
        :       'COUNT' PLS_LPAREN asterisk_or_nested_expression PLS_RPAREN
        |	'DISTINCT' parenthesized_or_simple_nested_expression
        ;

asterisk_or_nested_expression
        :       PLS_ASTERISK
        |       nested_expression
        ;

special_expression
        :       'COUNT' PLS_LPAREN asterisk_or_nested_expression PLS_RPAREN
        |	'DISTINCT' parenthesized_nested_expression
	;
interval_expression
	:	sql_expression
                interval_day_or_year_spec
	;

interval_day_or_year_spec
        :       'DAY' opt_parenthesized_leading_field_precision 'TO' 'SECOND' opt_parethesized_fractional_second_precision
        |	'YEAR' opt_parenthesized_leading_field_precision 'TO' 'MONTH'
        ;

opt_parenthesized_leading_field_precision
        :       parenthesized_leading_field_precision
        |
        ;

parenthesized_leading_field_precision
        :       PLS_LPAREN leading_field_precision PLS_RPAREN
        ;

leading_field_precision
        :	integer
	;

opt_parethesized_fractional_second_precision
        :       parethesized_fractional_second_precision
        |
        ;

parethesized_fractional_second_precision
        :       PLS_LPAREN fractional_second_precision PLS_RPAREN
        ;

fractional_second_precision
        :	integer
	;
object_access_expression
	:
	;
scalar_subquery_expression
	:
	;
model_expression
	:
	;
type_constructor_expression
	:
	;
variable_expression
	:
	;
sequence_name
	:	identifier
	;
integer
        :	PLS_NUMBER
	;


opt_alias
        :       alias
        |
        ;

alias
        :	opt_as sql_identifier
	;

opt_parenthesized_column_specs
        :       parenthesized_column_specs
        |
        ;

parenthesized_column_specs
        :       PLS_LPAREN column_specs PLS_RPAREN
        ;

column_specs
        :	column_spec kleene_tail_column_specs
	;

opt_column_spec
        :       column_spec
        |
        ;

kleene_tail_column_specs
        :       kleene_tail_column_specs tail_column_spec
        |
        ;

tail_column_spec
        :       PLS_COMMA column_spec
        ;

column_spec
        :	sql_identifiers
	;

column_name
        :	sql_identifier
	;
nested_table
        :	sql_identifier
	;
nested_table_column_name
        :	opt_schema_prefix table_name PLS_DOT nested_table PLS_DOT column_name
	;

user_defined_function
        :	sql_identifiers opt_dot_exists_or_prior_or_delete
	;


opt_dot_exists_or_prior_or_delete
        :       dot_exists_or_prior_or_delete
        |
        ;

dot_exists_or_prior_or_delete
        :       PLS_DOT exists_or_prior_or_delete
        ;

exists_or_prior_or_delete
        :       'EXISTS'
        |       prior
        |       'DELETE'
        ;

selected_table
        :	table_spec_or_opt_table_or_the_subquery opt_alias
	;

table_spec_or_opt_table_or_the_subquery
        :       table_spec
        |       opt_table_or_the_subquery
        ;

opt_table_or_the_subquery
        :       opt_table_or_the subquery
        |
        ;

opt_table_or_the
        :       table_or_the
        |
        ;

table_or_the
        :       'TABLE'
        |       'THE'
        ;

table_spec
        :	opt_schema_prefix table_name opt_at_sign_link_name
	;

opt_at_sign_link_name
        :       at_sign_link_name
        |
        ;

at_sign_link_name
        :       PLS_AT_SIGN link_name
        ;

table_alias
        :	opt_schema_prefix table_name opt_at_sign_link_name opt_alias
	;

link_name
        :	sql_identifier
	;
nested_condition
        :	condition_or
        |	expr_bool
	;
sql_condition

	:	condition_or

	;
condition_paren
        :	PLS_LPAREN sql_condition PLS_RPAREN
	;
condition_or
        :	condition_and kleene_or_condition_ands
	;

kleene_or_condition_ands
        :       kleene_or_condition_ands or_condition_and
        |
        ;

or_condition_and
        :       'OR' condition_and
        ;
condition_and
        :	condition_not kleene_and_condition_nots
	;

kleene_and_condition_nots
        :       kleene_and_condition_nots and_condition_not
        |
        ;

and_condition_not
        :       'AND' condition_not
        ;

condition_not
        :	not condition_expr
	|	condition_expr
	;
condition_expr
	:	condition_exists
	|	condition_is
	|	condition_comparison
	|	condition_group_comparison
	|	condition_in
	|	condition_is_a_set
	|	condition_is_any
	|	condition_is_empty
	|	condition_is_of_type
	|	condition_is_present
	|	condition_like
	|	condition_memeber
	|	condition_between
	|	condition_regexp_like
	|	condition_submultiset
	|	condition_equals_path
	|	condition_under_path
	|	condition_paren
	;
condition_exists
        :	'EXISTS' parenthesized_select_command
	;
condition_is
        :	sql_expression 'IS' opt_not nan_infinite_or_null
	;

nan_infinite_or_null
        :       'NAN'
        |       'INFINITE'
        |       'NULL'
        ;

condition_comparison
        :	PLS_LPAREN sql_expressions PLS_RPAREN opt_outer_join_sign eq_or_not_eq parenthesized_select_command opt_outer_join_sign
        |	opt_prior sql_expression opt_outer_join_sign comparison_operator opt_prior sql_expression_or_parenthesized_select_command opt_outer_join_sign
	;

opt_prior
        :       prior
        |
        ;

prior
        :      'PRIOR'
        ;

comparison_operator
        :       relational_op
        ;

eq_or_not_eq
        :       PLS_EQ
        |       PLS_NOT_EQ
        ;

condition_group_comparison
        :	PLS_LPAREN sql_expressions PLS_RPAREN eq_or_not_eq any_or_some_or_all PLS_LPAREN grouping_expression_list_or_select_command PLS_RPAREN
        |	sql_expression comparison_operator any_or_some_or_all PLS_LPAREN sql_expressions_or_select_command PLS_RPAREN
	;

sql_expressions_or_select_command
        :       sql_expressions
        |       select_command
        ;

grouping_expression_list_or_select_command
        :       grouping_expression_list
        |       select_command
        ;

any_or_some_or_all
        :       'ANY'
        |       'SOME'
        |       'ALL'
        ;

condition_in
        :	PLS_LPAREN sql_expressions PLS_RPAREN opt_not 'IN' PLS_LPAREN grouping_expression_list_or_select_command PLS_RPAREN
        |	sql_expression opt_not 'IN' PLS_LPAREN expression_list_or_select_command PLS_RPAREN
	;

expression_list_or_select_command
        :       expression_list
        |       select_command
        ;

condition_is_a_set
        :	nested_table_column_name 'IS' opt_not 'A' 'SET'
	;
condition_is_any
        :	opt_column_name_is 'ANY'
	;

opt_column_name_is
        :       column_name_is
        |
        ;

column_name_is
        :       column_name 'IS'
        ;

condition_is_empty
        :	nested_table_column_name 'IS' opt_not 'EMPTY'
	;
condition_is_of_type
        :	sql_expression 'IS' opt_not of opt_type PLS_LPAREN type_name PLS_RPAREN
	;

opt_type
        :       type
        |
        ;

type
        :       'TYPE'
        ;

condition_is_of_type_names
        :	condition_is_of_type_name kleene_tail_condition_is_of_type_names
	;

kleene_tail_condition_is_of_type_names
        :       kleene_tail_condition_is_of_type_names tail_condition_is_of_type_name
        |
        ;

tail_condition_is_of_type_name
        :       PLS_COMMA condition_is_of_type_name
        ;

condition_is_of_type_name
        :	opt_only type_name
	;

opt_only
        :       only
        |
        ;

only
        :       'ONLY'
        ;

condition_is_present
        :	cell_reference 'IS' 'PRESENT'
	;
condition_like
        :	sql_expression opt_not likes sql_expression opt_escape_sql_expression
	;

likes
        :       'LIKE' | 'LIKEC' | 'LIKE2' | 'LIKE4'
        ;

opt_escape_sql_expression
        :       escape_sql_expression
        |
        ;

escape_sql_expression
        :       'ESCAPE' sql_expression
        ;

condition_memeber
        :	sql_expression opt_not 'MEMBER' opt_of nested_table_column_name
	;

opt_of
        :       of
        |
        ;

of
        :       'OF'
        ;

condition_between
        :	sql_expression opt_not 'BETWEEN' sql_expression 'AND' sql_expression
	;
condition_regexp_like
        :	'REGEXP_LIKE' PLS_LPAREN call_parameters PLS_RPAREN
	;
condition_submultiset
        :	nested_table_column_name opt_not 'SUBMULTISET' opt_of nested_table_column_name
	;
condition_equals_path
        :	'EQUALS_PATH' PLS_LPAREN column_name PLS_COMMA path_string opt_comma_correlation_integer PLS_RPAREN
	;

opt_comma_correlation_integer
        :       comma_correlation_integer
        |
        ;

comma_correlation_integer
        :       PLS_COMMA correlation_integer
        ;

condition_under_path
        :	'UNDER_PATH' PLS_LPAREN column_name opt_comma_levels PLS_COMMA path_string opt_comma_correlation_integer PLS_RPAREN
	;

opt_comma_levels
        :       comma_levels
        |
        ;

comma_levels
        :       PLS_COMMA levels
        ;

levels
	:	integer
	;
correlation_integer
	:	integer
	;
path_string
        :	PLS_QUOTED_STRING
	;
grouping_expression_list
        :	expression_list kleene_tail_expression_lists
	;

kleene_tail_expression_lists
        :       kleene_tail_expression_lists tail_expression_list
        |
        ;

tail_expression_list
        :       PLS_COMMA expression_list
        ;

expression_list
        :	PLS_LPAREN sql_expressions PLS_RPAREN
	|	sql_expressions
	;
cell_reference
        :	sql_identifier
	;

opt_parenthesized_opt_call_parameters
        :       parenthesized_opt_call_parameters
        |
        ;

parenthesized_opt_call_parameters
        :       PLS_LPAREN opt_call_parameters PLS_RPAREN
        ;

opt_call_parameters
        :       call_parameters
        |
        ;

call_parameters
        :	call_parameter kleene_tail_call_parameters
	;

kleene_tail_call_parameters
        :       kleene_tail_call_parameters tail_call_parameter
        |
        ;

tail_call_parameter
        :       PLS_COMMA call_parameter
        ;

call_parameter
        :	opt_parameter_name_arrow nested_expression
	;

opt_parameter_name_arrow
        :       parameter_name_arrow
        |
        ;

parameter_name_arrow
        :       parameter_name PLS_ARROW
        ;

relational_op
        :	eq_or_not_eq | PLS_LESS_THAN | PLS_GREATER_THAN | PLS_LESS_THAN_EQUAL | PLS_GREATER_THAN_EQUAL
	;

exp_set
        :	 sql_expression
        |	 subquery
	;

subquery
        :	parenthesized_select_command
	;

connect_clause
        :	opt_start_with_condition
		'CONNECT' 'BY' 
                connect_by_first_part
                connect_by_second_part
                start_with_condition
	;

connect_by_first_part
        :       prior sql_expression relational_op sql_expression
        |	sql_expression relational_op sql_expression prior
        ;

connect_by_second_part
        :       opt_prior sql_condition
        |	sql_expression relational_op opt_prior sql_expression opt_and_sql_condition
        ;

opt_and_sql_condition
        :       and_sql_condition
        |
        ;

and_sql_condition
        :       'AND' sql_condition
        ;

opt_start_with_condition
        :       start_with_condition
        |
        ;

start_with_condition
        :       'START' 'WITH' sql_condition
        ;

group_clause
        :	'GROUP' 'BY' sql_expression kleene_tail_sql_expressions opt_having_sql_condition
	;

opt_having_sql_condition
        :       having_sql_condition
        |
        ;

having_sql_condition
        :       'HAVING' sql_condition
        ;

set_clause
        :	union_all_or_intersect_or_minus select_command
	;

union_all_or_intersect_or_minus
        :       union_all
        |       'INTERSECT'
        |       'PLS_MINUS'
        ;

union_all
        :       'UNION' 'ALL'
        ;

order_clause
        :	'ORDER' 'BY' sorted_def kleene_tail_sorted_defs
	;

kleene_tail_sorted_defs
        :       kleene_tail_sorted_defs tail_sorted_def
        |
        ;

tail_sorted_def
        :       PLS_COMMA sorted_def
        ;

sorted_def
        :	sql_expression_or_number opt_asc_or_desc
	;

sql_expression_or_number
        :       sql_expression
        |       PLS_NUMBER
        ;

update_clause
        :	'FOR' 'UPDATE' opt_of_column_names opt_nowait
	;

opt_of_column_names
        :       of_column_names
        |
        ;

of_column_names
        :       of column_name kleene_tail_column_names
        ;

kleene_tail_column_names
        :       kleene_tail_column_names tail_column_name
        |
        ;

tail_column_name
        :       PLS_COMMA column_name
        ;

insert_command
	:	'INSERT' 'INTO' table_reference_list
                opt_parenthesized_column_specs
                insert_values_or_select_statement
                opt_returning_clause
	;

insert_values_or_select_statement
        :       'VALUES' parenthesized_plsql_expressions
        |	select_statement
        ;

update_command
	:	'UPDATE' selected_table
		'SET' 
                update_nested_column_specs_or_update_column_specs
                opt_update_where_clause
                opt_returning_clause
	;

opt_update_where_clause
        :       update_where_clause
        |
        ;

update_where_clause
        :       'WHERE' current_of_or_sql_condition
        ;

current_of_or_sql_condition
        :       'CURRENT_OF' cursor_name
        |	sql_condition
        ;

update_nested_column_specs_or_update_column_specs
        :       update_nested_column_specs
        |	update_column_specs
        ;

update_column_specs
        :	update_column_spec kleene_tail_update_column_specs
	;

kleene_tail_update_column_specs
        :       kleene_tail_update_column_specs tail_update_column_spec
        |
        ;

tail_update_column_spec
        :       PLS_COMMA update_column_spec
        ;

update_column_spec
        :	column_spec PLS_EQ sql_expression
	;

update_nested_column_specs
        :	update_nested_column_spec kleene_tail_update_nested_column_specs
	;

kleene_tail_update_nested_column_specs
        :       kleene_tail_update_nested_column_specs tail_update_nested_column_spec
        |
        ;

tail_update_nested_column_spec
        :       PLS_COMMA update_nested_column_spec
        ;

update_nested_column_spec
        :	parenthesized_column_specs PLS_EQ subquery
	;

delete_command
        :	'DELETE' opt_from selected_table
                opt_update_where_clause
                opt_returning_clause
	;

opt_from
        :       from
        |
        ;

from
        :       'FROM'
        ;

opt_returning_clause
        :       returning_clause
        |
        ;

returning_clause
        :	return_or_returning select_list opt_bulk_collect 'INTO' lvalues
	;

return_or_returning
        :       return
        |       'RETURNING'
        ;

return
        :       'RETURN'
        ;

set_transaction_command
        :	'SET' 'TRANSACTION' 'READ' 'ONLY'
	;

close_statement
        :	'CLOSE' cursor_name
	;

fetch_statement
	:	'FETCH' cursor_name 'INTO' 
                variable_names_or_record_name
	;

variable_names_or_record_name
        :       variable_names
        |	record_name
        ;

lock_table_statement
	:	'LOCK' 'TABLE' table_reference_list
                'IN' lock_mode 'MODE' opt_nowait
	;

lock_mode
	:	'ROW' 'SHARE'
	|	'ROW' 'EXCLUSIVE'
	|	'SHARE' 'UPDATE'
	|	'SHARE'
	|	'SHARE' 'ROW' 'EXCLUSIVE'
	|	'EXCLUSIVE'
	;

open_statement
        :	'OPEN' cursor_name opt_parenthesized_plsql_expressions
	;

rollback_statement
        :	'ROLLBACK' opt_work
                opt_to_savepoint
                opt_comment_quoted_string
	;

opt_comment_quoted_string
        :       comment_quoted_string
        |
        ;

comment_quoted_string
        :       'COMMENT' quoted_string
        ;

opt_to_savepoint
        :       to_savepoint
        |
        ;

to_savepoint
        :       'TO' opt_savepoint savepoint_name
        ;

opt_savepoint
        :       savepoint
        |
        ;

savepoint
        :       'SAVEPOINT'
        ;

opt_work
        :       work
        |
        ;

work
        :       'WORK'
        ;

savepoint_statement
        :	savepoint savepoint_name
	;

savepoint_name
	:	identifier
	;

identifier
        :	PLS_ID
        |	PLS_DOUBLEQUOTED_STRING
   	;

quoted_string
        :	PLS_QUOTED_STRING
	;

match_string
        :	PLS_QUOTED_STRING
	;

sql_identifiers
        :	sql_identifier kleene_tail_sql_identifiers
        ;

kleene_tail_sql_identifiers
        :       kleene_tail_sql_identifiers tail_sql_identifier
        |
        ;

tail_sql_identifier
        :       PLS_DOT sql_identifier
        ;

sql_identifier
	:	identifier
	;

type_attr
        :	'%TYPE'
        ;
rowtype_attr
        :	'%ROWTYPE'
        ;
charset_attr
        :	'%CHARSET'
        ;
